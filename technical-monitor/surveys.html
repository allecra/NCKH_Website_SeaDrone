<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản lý Báo cáo Khảo sát - SeaDrone Rescue</title>
    <link rel="stylesheet" href="../css/styles.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            min-height: 100vh;
            color: #333;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 25px;
            padding: 35px;
            margin-bottom: 30px;
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.15);
            border: 2px solid rgba(255, 255, 255, 0.3);
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(45deg, transparent, rgba(102, 126, 234, 0.1), transparent);
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
            100% { transform: translateX(100%) translateY(100%) rotate(45deg); }
        }

        .header h1 {
            font-size: 3rem;
            background: linear-gradient(45deg, #667eea, #764ba2, #f093fb, #f5576c);
            background-size: 400% 400%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: gradientText 3s ease infinite;
            margin-bottom: 15px;
            position: relative;
            z-index: 1;
        }

        @keyframes gradientText {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .header-subtitle {
            color: #666;
            font-size: 1.1rem;
            margin-bottom: 20px;
        }

        .header-actions {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }

        .search-box {
            position: relative;
            flex: 1;
            min-width: 300px;
        }

        .search-box input {
            width: 100%;
            padding: 12px 20px 12px 45px;
            border: 2px solid #e1e5e9;
            border-radius: 25px;
            font-size: 14px;
            transition: all 0.3s ease;
            background: #fff;
        }

        .search-box input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.2);
        }

        .search-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #999;
        }

        .filter-select {
            padding: 12px 20px;
            border: 2px solid #e1e5e9;
            border-radius: 25px;
            font-size: 14px;
            background: #fff;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 200px;
        }

        .filter-select:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
            transform: translateY(-2px);
        }

        .btn-warning {
            background: #ffc107;
            color: #212529;
        }

        .btn-warning:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }

        .btn-sm {
            padding: 8px 16px;
            font-size: 12px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.15);
            border: 2px solid rgba(255, 255, 255, 0.3);
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            transition: left 0.5s;
        }

        .stat-card:hover {
            transform: translateY(-10px) scale(1.05);
            box-shadow: 0 25px 70px rgba(0, 0, 0, 0.25);
        }

        .stat-card:hover::before {
            left: 100%;
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .stat-label {
            color: #666;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .pending { 
            color: #ffc107; 
            text-shadow: 0 0 20px rgba(255, 193, 7, 0.5);
        }
        .active { 
            color: #28a745; 
            text-shadow: 0 0 20px rgba(40, 167, 69, 0.5);
        }
        .completed { 
            color: #007bff; 
            text-shadow: 0 0 20px rgba(0, 123, 255, 0.5);
        }
        .cancelled { 
            color: #dc3545; 
            text-shadow: 0 0 20px rgba(220, 53, 69, 0.5);
        }

        .surveys-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .surveys-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .surveys-title {
            font-size: 1.8rem;
            color: #333;
        }

        .survey-grid {
            display: grid;
            gap: 20px;
        }

        .survey-card {
            background: linear-gradient(135deg, #fff 0%, #f8f9ff 100%);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.12);
            border: 2px solid transparent;
            background-clip: padding-box;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
            overflow: hidden;
        }

        .survey-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #667eea, #764ba2, #f093fb, #f5576c);
            background-size: 400% 400%;
            animation: gradientShift 3s ease infinite;
        }

        .survey-card::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 150px;
            height: 150px;
            background: radial-gradient(circle, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.05), transparent);
            border-radius: 50%;
            transform: translate(50px, -50px);
        }

        .survey-card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
            border-color: rgba(102, 126, 234, 0.3);
        }

        .survey-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .survey-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }

        .survey-id {
            font-size: 0.85rem;
            color: #999;
            font-family: monospace;
        }

        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-pending {
            background: rgba(255, 193, 7, 0.2);
            color: #856404;
            border: 1px solid rgba(255, 193, 7, 0.3);
        }

        .status-active {
            background: rgba(40, 167, 69, 0.2);
            color: #155724;
            border: 1px solid rgba(40, 167, 69, 0.3);
        }

        .status-completed {
            background: rgba(0, 123, 255, 0.2);
            color: #004085;
            border: 1px solid rgba(0, 123, 255, 0.3);
        }

        .status-cancelled {
            background: rgba(220, 53, 69, 0.2);
            color: #721c24;
            border: 1px solid rgba(220, 53, 69, 0.3);
        }

        .survey-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .info-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .info-icon {
            width: 18px;
            height: 18px;
            color: #667eea;
        }

        .info-label {
            font-weight: 600;
            color: #555;
        }

        .info-value {
            color: #777;
        }

        .survey-description {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            color: #666;
            line-height: 1.6;
        }

        .survey-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background-color: #fff;
            margin: 5% auto;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            position: relative;
        }

        .close {
            position: absolute;
            right: 20px;
            top: 20px;
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .close:hover {
            color: #000;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .form-actions {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
            margin-top: 30px;
        }

        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 10px;
            color: white;
            font-weight: 600;
            z-index: 1001;
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast-success {
            background: #28a745;
        }

        .toast-error {
            background: #dc3545;
        }

        .toast-warning {
            background: #ffc107;
            color: #212529;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }

        .empty-state svg {
            width: 80px;
            height: 80px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .header-actions {
                flex-direction: column;
                align-items: stretch;
            }

            .search-box {
                min-width: auto;
            }

            .survey-info {
                grid-template-columns: 1fr;
            }

            .survey-actions {
                justify-content: center;
            }

            .modal-content {
                margin: 10% auto;
                width: 95%;
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>🚁 Quản lý Báo cáo Khảo sát</h1>
            <p class="header-subtitle">Hệ thống quản lý báo cáo khảo sát biển cho đội cứu hộ SeaDrone</p>
            
            <div class="header-actions">
                <div class="search-box">
                    <span class="search-icon">🔍</span>
                    <input type="text" id="searchInput" placeholder="Tìm kiếm báo cáo khảo sát..." onkeyup="filterSurveys()">
                </div>
                
                <select id="statusFilter" class="filter-select" onchange="filterSurveys()">
                    <option value="">Tất cả trạng thái</option>
                    <option value="pending">Chờ thực hiện</option>
                    <option value="active">Đang thực hiện</option>
                    <option value="completed">Hoàn thành</option>
                    <option value="cancelled">Đã hủy</option>
                </select>
                
                <select id="teamFilter" class="filter-select" onchange="filterSurveys()">
                    <option value="">Tất cả đội</option>
                    <option value="team1">Đội Alpha</option>
                    <option value="team2">Đội Beta</option>
                    <option value="team3">Đội Gamma</option>
                </select>
                
                <button onclick="createSurvey()" class="btn btn-primary">
                    ➕ Thêm Báo cáo
                </button>
            </div>
        </div>

        <!-- Statistics -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number pending" id="pendingCount">12</div>
                <div class="stat-label">Chờ thực hiện</div>
            </div>
            <div class="stat-card">
                <div class="stat-number active" id="activeCount">5</div>
                <div class="stat-label">Đang thực hiện</div>
            </div>
            <div class="stat-card">
                <div class="stat-number completed" id="completedCount">28</div>
                <div class="stat-label">Hoàn thành</div>
            </div>
            <div class="stat-card">
                <div class="stat-number cancelled" id="cancelledCount">3</div>
                <div class="stat-label">Đã hủy</div>
            </div>
        </div>

        <!-- Surveys Container -->
        <div class="surveys-container">
            <div class="surveys-header">
                <h2 class="surveys-title">Danh sách Báo cáo Khảo sát</h2>
                <div>
                    <button onclick="exportReports()" class="btn btn-secondary btn-sm">
                        📊 Xuất báo cáo
                    </button>
                </div>
            </div>

            <div id="surveyList" class="survey-grid">
                <!-- Surveys will be populated here -->
            </div>
        </div>
    </div>

    <!-- Survey Detail/Edit Modal -->
    <div id="surveyModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2 id="modalTitle">Thông tin Báo cáo Khảo sát</h2>
            <form id="surveyForm">
                <input type="hidden" id="surveyId">
                
                <div class="form-group">
                    <label for="surveyName">Tên báo cáo khảo sát:</label>
                    <input type="text" id="surveyName" name="surveyName" required>
                </div>
                
                <div class="form-group">
                    <label for="beachId">Khu vực khảo sát:</label>
                    <select id="beachId" name="beachId" required>
                        <option value="">Chọn khu vực</option>
                        <option value="beach1">Bãi biển Nha Trang</option>
                        <option value="beach2">Bãi biển Đà Nẵng</option>
                        <option value="beach3">Bãi biển Vũng Tàu</option>
                        <option value="beach4">Bãi biển Hạ Long</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="teamId">Đội thực hiện:</label>
                    <select id="teamId" name="teamId" required>
                        <option value="">Chọn đội</option>
                        <option value="team1">Đội Alpha - Trưởng: Nguyễn Văn A</option>
                        <option value="team2">Đội Beta - Trưởng: Trần Thị B</option>
                        <option value="team3">Đội Gamma - Trưởng: Lê Văn C</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="status">Trạng thái:</label>
                    <select id="status" name="status" required>
                        <option value="pending">Chờ thực hiện</option>
                        <option value="active">Đang thực hiện</option>
                        <option value="completed">Hoàn thành</option>
                        <option value="cancelled">Đã hủy</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="scheduledTime">Thời gian thực hiện:</label>
                    <input type="datetime-local" id="scheduledTime" name="scheduledTime" required>
                </div>
                
                <div class="form-group">
                    <label for="assignedTo">Người chịu trách nhiệm:</label>
                    <input type="text" id="assignedTo" name="assignedTo" placeholder="Nhập tên người chịu trách nhiệm">
                </div>
                
                <div class="form-group">
                    <label for="priority">Mức độ ưu tiên:</label>
                    <select id="priority" name="priority">
                        <option value="low">Thấp</option>
                        <option value="medium">Trung bình</option>
                        <option value="high">Cao</option>
                        <option value="urgent">Khẩn cấp</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="description">Mô tả chi tiết:</label>
                    <textarea id="description" name="description" placeholder="Nhập mô tả chi tiết về nhiệm vụ khảo sát..."></textarea>
                </div>
                
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">💾 Lưu</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal()">❌ Hủy</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Toast notification -->
    <div id="toast" class="toast"></div>

    <script>
        // Sample data
        let surveys = [
            {
                id: 'SV001',
                name: 'Khảo sát khu vực Nha Trang - Tuần 1',
                beachId: 'beach1',
                beachName: 'Bãi biển Nha Trang',
                teamId: 'team1',
                teamName: 'Đội Alpha',
                status: 'active',
                scheduledTime: '2025-06-20T09:00',
                assignedTo: 'Nguyễn Văn A',
                priority: 'high',
                description: 'Khảo sát tình hình an toàn khu vực bãi biển Nha Trang, kiểm tra các điểm nguy hiểm và đánh giá mức độ rủi ro.',
                createdAt: '2025-06-15T10:30'
            },
            {
                id: 'SV002',
                name: 'Kiểm tra hệ thống cứu hộ Đà Nẵng',
                beachId: 'beach2',
                beachName: 'Bãi biển Đà Nẵng',
                teamId: 'team2',
                teamName: 'Đội Beta',
                status: 'completed',
                scheduledTime: '2025-06-18T14:00',
                assignedTo: 'Trần Thị B',
                priority: 'medium',
                description: 'Kiểm tra và đánh giá hiệu quả của hệ thống cứu hộ hiện tại tại khu vực bãi biển Đà Nẵng.',
                createdAt: '2025-06-14T08:15'
            },
            {
                id: 'SV003',
                name: 'Khảo sát nguy cơ sóng lớn Vũng Tàu',
                beachId: 'beach3',
                beachName: 'Bãi biển Vũng Tàu',
                teamId: 'team3',
                teamName: 'Đội Gamma',
                status: 'pending',
                scheduledTime: '2025-06-25T07:30',
                assignedTo: 'Lê Văn C',
                priority: 'urgent',
                description: 'Đánh giá nguy cơ sóng lớn trong mùa mưa bão và đề xuất các biện pháp phòng ngừa.',
                createdAt: '2025-06-16T16:45'
            }
        ];

        let filteredSurveys = [...surveys];
        let editingId = null;

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            renderSurveys();
            updateStats();
        });

        // Render surveys
        function renderSurveys() {
            const surveyList = document.getElementById('surveyList');
            
            if (filteredSurveys.length === 0) {
                surveyList.innerHTML = `
                    <div class="empty-state">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                        </svg>
                        <h3>Không tìm thấy báo cáo khảo sát</h3>
                        <p>Thử thay đổi bộ lọc hoặc thêm báo cáo khảo sát mới</p>
                    </div>
                `;
                return;
            }

            surveyList.innerHTML = filteredSurveys.map(survey => `
                <div class="survey-card">
                    <div class="survey-header">
                        <div>
                            <div class="survey-title">${survey.name}</div>
                            <div class="survey-id">ID: ${survey.id}</div>
                        </div>
                        <span class="status-badge status-${survey.status}">
                            ${getStatusText(survey.status)}
                        </span>
                    </div>
                    
                    <div class="survey-info">
                        <div class="info-item">
                            <span class="info-icon">🏖️</span>
                            <span class="info-label">Khu vực:</span>
                            <span class="info-value">${survey.beachName}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-icon">👥</span>
                            <span class="info-label">Đội:</span>
                            <span class="info-value">${survey.teamName}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-icon">👤</span>
                            <span class="info-label">Người thực hiện:</span>
                            <span class="info-value">${survey.assignedTo}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-icon">📅</span>
                            <span class="info-label">Thời gian:</span>
                            <span class="info-value">${formatDateTime(survey.scheduledTime)}</span>
                        </div>
                        <div class="info-item">
                            <span class="info-icon">⚡</span>
                            <span class="info-label">Ưu tiên:</span>
                            <span class="info-value">${getPriorityText(survey.priority)}</span>
                        </div>
                    </div>
                    
                    <div class="survey-description">
                        ${survey.description || 'Chưa có mô tả'}
                    </div>
                    
                    <div class="survey-actions">
                        <button onclick="viewSurvey('${survey.id}')" class="btn btn-primary btn-sm">
                            👁️ Xem
                        </button>
                        <button onclick="editSurvey('${survey.id}')" class="btn btn-warning btn-sm">
                            ✏️ Sửa
                        </button>
                        <button onclick="deleteSurvey('${survey.id}')" class="btn btn-danger btn-sm">
                            🗑️ Xóa
                        </button>
                        ${survey.status === 'pending' ? `
                            <button onclick="startSurvey('${survey.id}')" class="btn btn-secondary btn-sm">
                                ▶️ Bắt đầu
                            </button>
                        ` : ''}
                        ${survey.status === 'active' ? `
                            <button onclick="completeSurvey('${survey.id}')" class="btn btn-secondary btn-sm">
                                ✅ Hoàn thành
                            </button>
                        ` : ''}
                    </div>
                </div>
            `).join('');
        }

        // Filter surveys
        function filterSurveys() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const statusFilter = document.getElementById('statusFilter').value;
            const teamFilter = document.getElementById('teamFilter').value;

            filteredSurveys = surveys.filter(survey => {
                const matchesSearch = survey.name.toLowerCase().includes(searchTerm) ||
                                    survey.description.toLowerCase().includes(searchTerm) ||
                                    survey.assignedTo.toLowerCase().includes(searchTerm);
                const matchesStatus = !statusFilter || survey.status === statusFilter;
                const matchesTeam = !teamFilter || survey.teamId === teamFilter;

                return matchesSearch && matchesStatus && matchesTeam;
            });

            renderSurveys();
        }

        // Update statistics
        function updateStats() {
            const stats = surveys.reduce((acc, survey) => {
                acc.total += 1;
                acc[survey.status] = (acc[survey.status] || 0) + 1;
                return acc;
            }, { total: 0 });

            document.getElementById('totalSurveys').innerText = stats.total;
            document.getElementById('pendingSurveys').innerText = stats.pending || 0;
            document.getElementById('activeSurveys').innerText = stats.active || 0;
            document.getElementById('completedSurveys').innerText = stats.completed || 0;
            document.getElementById('cancelledSurveys').innerText = stats.cancelled || 0;
        }
        // Get status text
        function getStatusText(status) {
            switch (status) {
                case 'pending':
                    return 'Chờ thực hiện';
                case 'active':
                    return 'Đang thực hiện';
                case 'completed':
                    return 'Đã hoàn thành';
                case 'cancelled':
                    return 'Đã hủy';
                default:
                    return 'Không xác định';
            }
        }

        // Get priority text
        function getPriorityText(priority) {
            switch (priority) {
                case 'low':
                    return 'Thấp';
                case 'medium':
                    return 'Trung bình';
                case 'high':
                    return 'Cao';
                default:
                    return 'Không xác định';
            }
        }
        // Format date and time
        function formatDateTime(dateTime) {
            const date = new Date(dateTime);
            const options = {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                hour12: false
            };
            return date.toLocaleString('vi-VN', options);
        }

        // Create survey
        function createSurvey() {
            editingId = null;
            document.getElementById('surveyForm').reset();
        }

        // View survey details
        function viewSurvey(surveyId) {
            const survey = surveys.find(s => s.id === surveyId);
            if (survey) {
                document.getElementById('surveyDetails').innerHTML = `
                    <h3>${survey.name}</h3>
                    <p>${survey.description}</p>
                    <p><strong>Trạng thái:</strong> ${getStatusText(survey.status)}</p>
                    <p><strong>Độ ưu tiên:</strong> ${getPriorityText(survey.priority)}</p>
                    <p><strong>Ngày tạo:</strong> ${formatDateTime(survey.createdAt)}</p>
                `;
            }
        }

        // Edit survey
        function editSurvey(surveyId) {
            const survey = surveys.find(s => s.id === surveyId);
            if (survey) {
                document.getElementById('surveyForm').elements['name'].value = survey.name;
                document.getElementById('surveyForm').elements['description'].value = survey.description;
                document.getElementById('surveyForm').elements['status'].value = survey.status;
                document.getElementById('surveyForm').elements['priority'].value = survey.priority;
                editingId = surveyId;
            }
        }
        // Delete survey
        function deleteSurvey(surveyId) {
            surveys = surveys.filter(s => s.id !== surveyId);
            updateStats();
        }

        // Start survey
        function startSurvey(surveyId) {
            const survey = surveys.find(s => s.id === surveyId);
            if (survey) {
                survey.status = 'active';
                updateStats();
            }
        }

        // Complete survey
        function completeSurvey(surveyId) {
            const survey = surveys.find(s => s.id === surveyId);
            if (survey) {
                survey.status = 'completed';
                updateStats();
            }
        }

        // Export reports
        function exportReports() {
            const reportData = surveys.map(s => ({
                id: s.id,
                name: s.name,
                status: getStatusText(s.status),
                priority: getPriorityText(s.priority),
                createdAt: formatDateTime(s.createdAt)
            }));
            const csvContent = "data:text/csv;charset=utf-8," + reportData.map(e => Object.values(e).join(",")).join("\n");
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "survey_reports.csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
        // Show toast notification
        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            toast.innerText = message;
            document.body.appendChild(toast);
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }
        // Close modal
        function closeModal() {
            document.getElementById('surveyModal').style.display = 'none';
            document.getElementById('surveyForm').reset();
            editingId = null;
        }
        // Handle form submission
        document.getElementById('surveyForm').addEventListener('submit', function(event) {
            event.preventDefault();
            const form = event.target;
            const name = form.elements['name'].value;
            const description = form.elements['description'].value;
            const status = form.elements['status'].value;
            const priority = form.elements['priority'].value;

            if (editingId) {
                const surveyIndex = surveys.findIndex(s => s.id === editingId);
                if (surveyIndex !== -1) {
                    surveys[surveyIndex].name = name;
                    surveys[surveyIndex].description = description;
                    surveys[surveyIndex].status = status;
                    surveys[surveyIndex].priority = priority;
                }
            } else {
                const newSurvey = {
                    id: Date.now(),
                    name,
                    description,
                    status,
                    priority,
                    createdAt: new Date()
                };
                surveys.push(newSurvey);
            }
            updateStats();
            closeModal();
        });
        // Show modal
        function showModal() {
            document.getElementById('surveyModal').style.display = 'block';
        }
        // Close modal on outside click
        window.onclick = function(event) {
            if (event.target === document.getElementById('surveyModal')) {
                closeModal();
            }
        };
        // Close modal on escape key
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeModal();
            }
        });
    </script>
</body>
</html>